<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Best Places</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{{ url_for('static', filename='css/tailwind.css') }}" rel="stylesheet">
</head>

<body class="h-screen flex items-center justify-center" style="background: #dd5e89;
  background: -webkit-linear-gradient(to right, #dd5e89, #f7bb97);
  background: linear-gradient(to right, #dd5e89, #f7bb97);">
    <div class="flex w-full min-h-[75%] max-h-[75%]">
        <div class="bg-white p-8 rounded shadow-md text-center w-2/5 ml-10 mr-6">
            <div class="title-group mb-8">
                <h1 class="text-4xl font-bold text-gray-800">Best Places From {{ price_range_chosen }}</h1>
                <h3 class="text-xl text-gray-600">Here are some great places for you!</h3>
            </div>
            <div class="boxes-container flex items-center justify-center flex-col">
                <div class="left" style="overflow-y: auto; max-height: 350px;">
                </div>
            </div>
        </div>
        <div class="bg-white p-8 rounded shadow-md w-3/5 ml-6 mr-10 text-center" id="infoBox">
            <div class="title-group mb-8">
                <h1 class="text-4xl font-bold text-gray-800">Additional Information About The<br>Area You Chose</h1>
                <h3 class="text-xl text-gray-600">Details about the area.</h3>
            </div>
            <div>
                <h3 class="text-2xl font-bold" style="margin-right: calc(250/400*100%); margin-top: -2%;">Property Data:</h3>
            </div>
            <iframe id="mapIframe" width="425" height="325" style="border: 2px solid rgb(0,0,0); margin-top: -1%; margin-left: calc(180/400*100%);" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            <p id="selectedKey"></p>
        </div>
    </div>
    <script>
    fetch("/get_house_data")
        .then(response => response.json())
        .then(data => {
            const boxesContainer = document.querySelector('.boxes-container .left');

            if (data && data.PROPERTYADDRESS && Object.keys(data.PROPERTYADDRESS).length > 0) {
                const propertyAddresses = data.PROPERTYADDRESS;
                const fairMarketTotals = data.FAIRMARKETTOTAL;
                const livabilityScores = data.livability_score;
                const addressKeys = Object.keys(propertyAddresses); // Get all the keys (only 10 left from Python)
                const infoBox = document.getElementById('infoBox');
                const selectedKeyElement = document.getElementById('selectedKey');
                const mapIframe = document.getElementById('mapIframe');

                addressKeys.sort((a,b) => livabilityScores[b] - livabilityScores[a]); // Sort keys by livability score

                addressKeys.forEach(key => {
                    const address = propertyAddresses[key];
                    const fairMarketTotal = fairMarketTotals[key];
                    const livabilityScore = livabilityScores[key];

                    const houseBox = document.createElement('button');
                    houseBox.classList.add('house-box', 'w-[300px]', 'min-h-[100px]', 'bg-[#efefd7]', 'border-2', 'border-[#ccc]', 'rounded-xl', 'flex', 'flex-col', 'items-center', 'justify-center', 'text-2xl', 'font-bold', 'mb-6', 'hover:bg-gray-200');
                    houseBox.style.cssText = `
                        border: 2px solid #ccc;
                        border-radius: 0.75rem;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        font-size: 1.5rem;
                        font-weight: bold;
                        margin-bottom: 1.5rem;
                        width: 300px;
                        min-height: 100px;
                        text-align: center;
                        color: inherit;
                        padding: 0.5rem 1rem;
                        cursor: pointer;
                    `;
                    houseBox.innerHTML = `<p>${address}</p><p>Price: $${fairMarketTotal} | ${livabilityScore.toFixed(1)}</p>`;
                    houseBox.id = key;

                    houseBox.addEventListener('click', function() {
                        //selectedKeyElement.textContent = `Selected Key: ${key}`;
                        const mapUrl = `https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3030.891878849978!2d-75.3139787!3d39.7929925!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x89c6d9d57043c99f%3A0x4694698992989f6a!2s${encodeURIComponent(address + ", Pittsburgh, PA")}!5e0!3m2!1sen!2sus!4v1727009769297!5m2!1sen!2sus`;
                        mapIframe.src = mapUrl;
                    });

                    boxesContainer.appendChild(houseBox);
                });
            }
            else {
                const errorMessage = document.createElement('p');
                errorMessage.textContent = 'No properties found for your request. Please try again.'
                errorMessage.classList.add('text-xl', 'mt-4')
                boxesContainer.appendChild(errorMessage);
            }
        });
</script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>

</html>